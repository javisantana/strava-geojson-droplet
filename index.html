
<html>
  <head>
    <title>Strava to GeoJson</title>
    <link href="http://kevinburke.bitbucket.org/markdowncss/markdown.css" rel="stylesheet"></link>
  </head>
  <body>
    <h1>Strava to GeoJSON droplet</h1>
    <p>Drag this link to your bookmark:</p>
    <a href="javascript:%0A(function()%20%7B%0A%0A%20%20%2F%2F%20ajax%20get%0A%20%20function%20get(url%2C%20c)%20%7B%0A%20%20%20%20var%20x%20%3D%20new%20XMLHttpRequest()%3B%0A%20%20%20%20x.onreadystatechange%20%3D%20function()%20%7B%0A%20%20%20%20%20%20if%20(x.readyState%20%3D%3D%3D%204%20%26%26%20x.status%20%3D%3D%3D%20200)%20%7B%0A%20%20%20%20%20%20%20%20c(x.responseText)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20x.open(%22GET%22%2C%20url%2C%20true)%3B%0A%20%20%20%20x.send()%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20strava%20streams%20to%20geojson%0A%20%20function%20toGeoJSON(stream)%20%7B%0A%20%20%20%20var%20attrs%20%3D%20Object.keys(stream)%3B%0A%0A%20%20%20%20var%20geojson%20%3D%20%7B%0A%20%20%20%20%20%20%22type%22%3A%20%22FeatureCollection%22%2C%0A%20%20%20%20%20%20%22features%22%3A%20%5B%5D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20props(i)%20%7B%0A%20%20%20%20%20%20var%20p%20%3D%20%7B%7D%0A%20%20%20%20%20%20attrs.forEach(function%20(v)%20%7B%0A%20%20%20%20%20%20%20%20p%5Bv%5D%20%3D%20stream%5Bv%5D%5Bi%5D%3B%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20return%20p%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20stream.latlng.length%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20%20%20var%20pos%20%3D%20stream.latlng%5Bi%5D%3B%0A%20%20%20%20%20%20geojson.features.push(%7B%0A%20%20%20%20%20%20%20%20%22type%22%3A%20%22Feature%22%2C%0A%20%20%20%20%20%20%20%20%22geometry%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%22type%22%3A%20%22Point%22%2C%0A%20%20%20%20%20%20%20%20%20%20%22coordinates%22%3A%20%5Bpos%5B1%5D%2C%20pos%5B0%5D%5D%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%22properties%22%3A%20props(i)%0A%20%20%20%20%20%20%7D)%0A%20%20%20%20%7D%0A%0A%20%20%20%20return%20geojson%3B%0A%20%20%7D%0A%0A%20%20function%20download(t%2C%20fname)%20%7B%0A%20%20%20%20var%20data%20%3D%20new%20Blob(%5Bt%5D%2C%20%7B%20type%3A%20'application%2Fjson'%20%7D)%3B%0A%20%20%20%20var%20a%20%3D%20document.createElement('a')%3B%0A%20%20%20%20a.setAttribute('download'%2C%20fname)%3B%0A%20%20%20%20a.href%20%3D%20window.URL.createObjectURL(data)%3B%0A%20%20%20%20document.body.appendChild(a)%3B%0A%20%20%20%20a.click()%3B%0A%20%20%7D%0A%0A%20%20var%20API_URL_TEMPLATE%20%3D%20'http%3A%2F%2Fwww.strava.com%2Factivities%2F%7Bactivity_id%7D%2Fstreams%3Fstream_types%255B%255D%3Dresting%26stream_types%255B%255D%3Daltitude%26stream_types%255B%255D%3Dheartrate%26stream_types%255B%255D%3Dcadence%26stream_types%255B%255D%3Dtemp%26stream_types%255B%255D%3Ddistance%26stream_types%255B%255D%3Dgrade_smooth%26stream_types%255B%255D%3Dtime%26stream_types%255B%255D%3Dgrade_adjusted_distance%26stream_types%255B%255D%3Dlatlng'%3B%0A%20%20%2F%2F%20activity%20id%20from%20url%0A%20%20var%20activity_id%20%3D%20%2F%5B0-9%5D%2B%24%2F.exec(location.href)%3B%0A%20%20if%20(activity_id%20!%3D%3D%20null)%20%7B%0A%20%20%20%20%2F%2F%20fetch%20%0A%20%20%20%20get(API_URL_TEMPLATE.replace('%7Bactivity_id%7D'%2C%20activity_id)%2C%20function(streamsData)%20%7B%0A%20%20%20%20%20%20var%20streams%20%3D%20JSON.parse(streamsData)%3B%0A%20%20%20%20%20%20%2F%2F%20generate%20%0A%20%20%20%20%20%20var%20geoJSON%20%3D%20toGeoJSON(streams)%3B%0A%20%20%20%20%20%20%2F%2F%20download%0A%20%20%20%20%20%20download(JSON.stringify(geoJSON)%2C%20%22strava_%22%20%2B%20activity_id%20%2B%20%22.geojson%22)%0A%20%20%20%20%7D)%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20alert('not%20a%20strava%20activity%20page')%3B%0A%20%20%7D%0A%0A%0A%0A%7D)()%3B%0A">Strava-GeoJSON</a>

    <p>After installing it go to any activity page and click on Strava-GeoJSON link, a GeoJSON file will be downloaded</p>
    <p>Then you can upload to <a href="http://cartodb.com/">CartoDB</a> and create maps like this:</p>
    <iframe width='620' height='500' frameborder='0' src='http://rambo-test.cartodb.com/viz/812e0f1e-91a6-11e4-b348-0e853d047bba/embed_map' allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
    <p>questions to <a href="http://twitter.com/javisantana">@javisantana</a></p>
    <p><a href="https://github.com/javisantana/strava-geojson-droplet">source code</a></p>
  </body>

</html>
